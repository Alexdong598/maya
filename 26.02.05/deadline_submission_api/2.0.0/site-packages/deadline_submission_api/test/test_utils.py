"""Test the deadline_submission_api utils functions."""

# Import local modules
from deadline_submission_api import options
from deadline_submission_api import utils

# Import third-party modules
import pytest


@pytest.mark.parametrize('parameter,key', [
    (options.JobParameters, 'EnvironmentKeyValue'),
    (options.PluginParameters, 'Cameras')
])
@pytest.mark.usefixtures('setup_test_plugin')
def test_add_parameter_key_and_get_parameters(parameter, key):
    """Test we set and get parameters of Deadline."""
    parameter = parameter('custom_plugin')
    utils.set_parameter_key(parameter, key, 'test_value')
    assert 'test_value' in utils.get_parameters(parameter, key)


@pytest.mark.parametrize('parameter,key', [
    (options.JobParameters, 'EnvironmentKeyValue'),
    (options.PluginParameters, 'Cameras')
])
@pytest.mark.usefixtures('setup_test_plugin')
def test_get_key_value_amount(parameter, key):
    """Test gets the Deadline job parameter key amount."""
    parameter = parameter('custom_plugin')
    if key == 'Cameras':
        utils.set_parameter_key(parameter, key, 'test_value')
        assert utils.get_key_value_amount(parameter, key) == 1
    else:
        assert utils.get_key_value_amount(parameter, key) == 0


@pytest.mark.parametrize("test_platform, test_files, result", [
    ("Windows", ["X:/test.ma", "X:/_temp/test.mb"],
     ["X:/test.ma", "X:/_temp/test.mb"]),
    ("Linux", ["/mnt/x/_temp/test.ma", "/mnt/x/test.ma"],
     ["X:/_temp/test.ma", "X:/test.ma"])
])
def test_convert_auxiliary_list_pathing(test_platform, test_files, result):
    """Test converting list of auxiliary file paths to windows equivalent."""
    assert utils.convert_auxiliary_pathing(test_files, test_platform) == result


@pytest.mark.parametrize("test_platform, test_file, result", [
    ("Windows", "X:/test.txt", ["X:/test.txt"]),
    ("Linux", "/mnt/x/_temp/test.txt", ["X:/_temp/test.txt"])
])
def test_convert_auxiliary_string_pathing(test_platform, test_file, result):
    """Test converting string auxiliary file path to windows equivalent."""
    assert utils.convert_auxiliary_pathing(test_file, test_platform) == result
