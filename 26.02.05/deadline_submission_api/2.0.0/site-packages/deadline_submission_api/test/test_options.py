"""Test for the deadline_submission_api.options functions."""

# Import local modules
from deadline_submission_api.options import JobParameters  # noqa: I100
from deadline_submission_api.options import PluginParameters  # noqa: I100


def test_plugin_name(create_temp_plugin):
    """Test plugin parameters use the plugin name."""
    plugin_name = 'hal_nuke'
    options = ('[Version]\n'
               'Required=false\n')
    test_data = {'plugin_name': plugin_name, 'options': options}
    create_temp_plugin(test_data)
    deadline_info = PluginParameters(plugin_name)

    # pylint: disable=protected-access
    assert plugin_name == deadline_info._plugin_name


def test_job_parameters(create_temp_plugin):
    """Test Deadline job parameters use the plugin name."""
    plugin_name = 'plugin_name'
    deadline_info = JobParameters(plugin_name)
    assert plugin_name == deadline_info.Plugin


def test_expand_shell_variables():
    """Test Deadline job expand shell variables and override parameters."""
    plugin_name = 'plugin_name'
    deadline_job_parameters = {
        'Name': 'jad_ba_0300_cgfx_v001_hal.hip',
        'UserName': '${TestUserName}',
        'Plugin': '${TestPluginName}',
        'Frames': '998-1115',
        'ChunkSize': 2,
        'Pool': 'all',
        'SecondaryPool': 'all',
        'SendJobErrorWarning': False,
        'MachineLimit': 7,
        'OverrideTaskExtraInfoNames': False,
        'OutputDirectory0': 'c:/test/output/path',
        'OutputFilename0': 'test.%04d%.exr'
    }

    deadline_info = JobParameters(plugin_name)
    deadline_info.update(deadline_job_parameters)
    submit_info = deadline_info.make_submit_info()
    output_file_name = submit_info['OutputFilename0']
    user_name = submit_info['UserName']
    plugin_name = submit_info['Plugin']
    assert user_name == 'test.user'
    assert plugin_name == 'custom_plugin'
    assert output_file_name == 'test.%04d%.exr'


def test_get_job_parameters(create_temp_plugin):
    """Test get attributes of the Deadline job parameters."""
    plugin_name = 'plugin_name'
    deadline_info = JobParameters(plugin_name)
    deadline_info.update({'UserName': '${TestUserName}',
                          'ChunkSize': 5})
    assert deadline_info.UserName == 'test.user'
    assert deadline_info.ChunkSize == 5
