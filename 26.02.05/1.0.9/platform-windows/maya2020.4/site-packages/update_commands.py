"""Script to update Maya command modules for Python 2 compatibility."""
import os
import re
import sys

COMMANDS_DIR = "mayaMenuBar/commands"

def update_file(filepath):
    """Update a single file for Python 2 compatibility."""
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # Add encoding if missing
    if not content.startswith('# -*- coding: utf-8 -*-'):
        content = '# -*- coding: utf-8 -*-\n' + content

    # Replace f-strings with format()
    content = re.sub(
        r'f"([^"]*)"', 
        lambda m: '"{}".format({})'.format(
            m.group(1).replace('{', '{{').replace('}', '}}'),
            m.group(1)
        ),
        content
    )
    content = re.sub(
        r"f'([^']*)'", 
        lambda m: "'{}'.format({})".format(
            m.group(1).replace('{', '{{').replace('}', '}}'),
            m.group(1)
        ), 
        content
    )

    # Special handling for mirror_joints copy.py
    if 'mirror_joints copy.py' in filepath:
        content = content.replace("\\xe2", "")

    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)

def main():
    """Main function to update all command modules."""
    for filename in os.listdir(COMMANDS_DIR):
        if filename.endswith('.py') and not filename.startswith('__'):
            filepath = os.path.join(COMMANDS_DIR, filename)
            print("Updating {}...".format(filename))
            update_file(filepath)
    print("All command modules updated successfully.")

if __name__ == '__main__':
    main()
