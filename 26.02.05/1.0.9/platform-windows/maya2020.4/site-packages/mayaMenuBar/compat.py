"""Python 2/3 compatibility utilities for Maya plugins."""
from __future__ import print_function
import sys

# Python version info
PY2 = sys.version_info[0] == 2
PY3 = sys.version_info[0] == 3

# String handling
if PY3:
    string_types = str
    text_type = str
    binary_type = bytes
else:
    string_types = basestring
    text_type = unicode
    binary_type = str

# Print function
if PY2:
    pass

# Reload function
if PY3:
    from importlib import reload as reload_module
else:
    # In Python 2, reload is a built-in
    reload_module = reload

# Dictionary methods
if PY3:
    def iterkeys(d):
        return d.keys()
    
    def itervalues(d):
        return d.values()
        
    def iteritems(d):
        return d.items()
else:
    def iterkeys(d):
        return d.iterkeys()
        
    def itervalues(d):
        return d.itervalues()
        
    def iteritems(d):
        return d.iteritems()

# URL handling
if PY3:
    from urllib.parse import urlparse, urljoin
    from urllib.request import urlopen
    from urllib.error import URLError
else:
    from urlparse import urlparse, urljoin
    from urllib2 import urlopen, URLError

# ConfigParser
if PY3:
    import configparser
else:
    import ConfigParser as configparser

# Queue
if PY3:
    import queue
else:
    import Queue as queue

# StringIO
if PY3:
    from io import StringIO
else:
    from StringIO import StringIO

# Range
if PY3:
    range = range
else:
    range = xrange

# Super function helper
def with_metaclass(meta, *bases):
    """Create a base class with a metaclass."""
    class metaclass(type):
        def __new__(cls, name, this_bases, d):
            return meta(name, bases, d)
    return type.__new__(metaclass, 'temporary_class', (), {})

# Integer conversion for pointers
def to_int_pointer(ptr):
    """Convert pointer to integer based on Python version."""
    if PY3:
        return int(ptr)
    else:
        return long(ptr)

# Unicode handling
def ensure_unicode(s):
    """Ensure string is unicode."""
    if PY2 and isinstance(s, str):
        return s.decode('utf-8')
    return s

def ensure_str(s):
    """Ensure string is byte string."""
    if PY3 and isinstance(s, str):
        return s.encode('utf-8')
    return s

if __name__ == '__main__':
    print("compat module loaded successfully")
    print("PY2:", PY2)
    print("PY3:", PY3)
